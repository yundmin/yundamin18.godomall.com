var nImageInfoCnt=0;var htImageInfo=[];var aResult=[];var rFilter=/^(image\/bmp|image\/gif|image\/jpg|image\/jpeg|image\/png)$/i;var rFilter2=/^(bmp|gif|jpg|jpeg|png)$/i;var nTotalSize=0;var nMaxImageSize=10*1024*1024;var nMaxTotalImageSize=50*1024*1024;var nMaxImageCount=10;var nImageFileCount=0;var bSupportDragAndDropAPI=false;var oFileUploader;var bAttachEvent=false;var elContent=$("pop_content");var elDropArea=jindo.$$.getSingle(".drag_area",elContent);var elDropAreaUL=jindo.$$.getSingle(".lst_type",elContent);var elCountTxtTxt=jindo.$$.getSingle("#imageCountTxt",elContent);var elTotalSizeTxt=jindo.$$.getSingle("#totalSizeTxt",elContent);var elTextGuide=$("guide_text");var welUploadInputBox=$Element("uploadInputBox");var oNavigator=jindo.$Agent().navigator();var welBtnConfirm=$Element("btn_confirm");var welBtnCancel=$Element("btn_cancel");var welTextGuide=$Element(elTextGuide);var welDropArea=$Element(elDropArea);var welDropAreaUL=$Element(elDropAreaUL);var fnUploadImage=null;function checkDragAndDropAPI(){try{if(!oNavigator.ie){if(!!oNavigator.safari&&oNavigator.version<=5){bSupportDragAndDropAPI=false}else{bSupportDragAndDropAPI=true}}else{bSupportDragAndDropAPI=false}}catch(a){bSupportDragAndDropAPI=false}}function goStartMode(){var a=welBtnConfirm.attr("src")||"";if(a.indexOf("btn_confirm2.png")<0){welBtnConfirm.attr("src","../../img/photoQuickPopup/btn_confirm2.png");fnUploadImage.attach(welBtnConfirm.$value(),"click")}}function goReadyMode(){var a=welBtnConfirm.attr("src")||"";if(a.indexOf("btn_confirm2.png")>=0){fnUploadImage.detach(welBtnConfirm.$value(),"click");welBtnConfirm.attr("src","../../img/photoQuickPopup/btn_confirm.png")}}function generalUpload(){oFileUploader.upload()}function readyModeBG(){var a=welTextGuide.className();if(a.indexOf("nobg")>=0){welTextGuide.removeClass("nobg");welTextGuide.className("bg")}}function startModeBG(){var a=welTextGuide.className();if(a.indexOf("nobg")<0){welTextGuide.removeClass("bg");welTextGuide.className("nobg")}}function updateViewCount(b,c){var a=b+c;elCountTxtTxt.innerHTML=a+"장";nImageFileCount=a;return a}function updateViewTotalSize(){var a=Number(parseInt((nTotalSize||0),10)/(1024*1024));elTotalSizeTxt.innerHTML=a.toFixed(2)+"MB"}function refreshTotalImageSize(b){var a=htImageInfo[b].size;if(nTotalSize-a>-1){nTotalSize=nTotalSize-a}}function removeImageInfo(a){htImageInfo[a]=null}function setUnitString(c){var b;var a;if(c<0){c=0}if(c<1024){b=Number(c);a="B";return b+a}else{if(c>(1024*1024)){b=Number(parseInt((c||0),10)/(1024*1024));a="MB";return b.toFixed(2)+a}else{b=Number(parseInt((c||0),10)/1024);a="KB";return b.toFixed(0)+a}}}function cuttingNameByLength(d,b){var c,a;if(d.length>b){a=d.indexOf(".");c=d.substring(0,b)+"..."+d.substring(a,d.length)}else{c=d}return c}function checkTotalImageSize(a){if(nTotalSize+a<nMaxTotalImageSize){nTotalSize=nTotalSize+a;return false}else{return true}}function dragEnter(a){a.stopPropagation();a.preventDefault()}function dragExit(a){a.stopPropagation();a.preventDefault()}function dragOver(a){a.stopPropagation();a.preventDefault()}function drop(g){g.stopPropagation();g.preventDefault();if(nImageFileCount>=10){alert("최대 10장까지만 등록할 수 있습니다.");return}if(typeof g.dataTransfer.files=="undefined"){alert("HTML5를 지원하지 않는 브라우저입니다.")}else{var b,f,d,a="";f=g.dataTransfer.files;d=f.length;if(!!f&&d===0){alert("정상적인 첨부방식이 아닙니다.");return}for(var e=0,c=nImageFileCount;e<d;e++){if(!rFilter.test(f[e].type)){alert("이미지파일 (jpg,gif,png,bmp)만 업로드 가능합니다.")}else{if(f[e].size>nMaxImageSize){alert("이미지 용량이 10MB를 초과하여 등록할 수 없습니다.")}else{if(c<nMaxImageCount){a+=addImage(f[e]);c=c+1;nImageInfoCnt=nImageInfoCnt+1}else{alert("최대 10장까지만 등록할 수 있습니다.");break}}}}if(c>0){startModeBG();if(a.length>1){welDropAreaUL.prependHTML(a)}updateViewTotalSize();nImageFileCount=c;updateViewCount(nImageFileCount,0);goStartMode()}else{readyModeBG()}}}function addImage(f){var f=f,e=0,d="",a="",c=false,b=[];e=setUnitString(f.size);d=cuttingNameByLength(f.name,15);c=checkTotalImageSize(f.size);if(!!c){alert("전체 이미지 용량이 50MB를 초과하여 등록할 수 없습니다. \n\n (파일명 : "+d+", 사이즈 : "+e+")")}else{htImageInfo["img"+nImageInfoCnt]=f;b.push('	<li id="img'+nImageInfoCnt+'" class="imgLi"><span>'+d+"</span>");b.push("	<em>"+e+"</em>");b.push("	<a onclick=\"delImage('img"+nImageInfoCnt+'\')"><img class="del_button" src="../../img/photoQuickPopup/btn_del.png"  width="14" height="13" alt="첨부 사진 삭제"></a>');b.push("	</li> ");a=b.join(" ");b=[]}return a}function html5Upload(){var c,f;f="/share/editor_file_uploader_html5_ps.php?editorUrl="+editorUrl;for(var b=0,a=0;b<nImageInfoCnt;b++){c=htImageInfo["img"+b];try{if(!!c){callAjaxForHTML5(c,f);a+=1}}catch(d){}c=null}}function getQueryVariable(c,a){var d=c.split("&");for(var b=0;b<d.length;b++){var e=d[b].split("=");if(decodeURIComponent(e[0])==a){return decodeURIComponent(e[1])}}console.log("Query variable %s not found",a)}function callAjaxForHTML5(a,b){var c=jindo.$Ajax(b,{type:"xhr",method:"post",async:false,onload:function(d){var e=d._response.responseText;if(d.readyState()==4){if(e.indexOf("NOTALLOW_")>-1){var f=e.replace("NOTALLOW_","");alert("이미지 파일(jpg,gif,png,bmp)만 업로드 하실 수 있습니다. ("+f+")")}else{makeArrayFromString(d._response.responseText)}}},timeout:3,onerror:jindo.$Fn(onAjaxError,this).bind()});c.header("contentType","multipart/form-data");c.header("file-name",encodeURIComponent(a.name));c.header("file-size",a.size);c.header("file-Type",a.type);c.request(a)}function makeArrayFromString(c){var d=[],g=[],f={};aResultleng=0;try{if(!c||c.indexOf("sFileURL")<0){return}d=c.split("&");for(var a=0;a<d.length;a++){if(!!d[a]&&d[a]!=""&&d[a].indexOf("=")>0){g=d[a].split("=");f[g[0]]=g[1]}}}catch(b){}aResultleng=aResult.length;aResult[aResultleng]=f;if(aResult.length==nImageFileCount){setPhotoToEditor(aResult);aResult=null;window.close()}}function delImage(b){var a=jindo.$$.getSingle("#"+b);refreshTotalImageSize(b);updateViewTotalSize();updateViewCount(nImageFileCount,-1);removeImageInfo(b);$Element(a).leave();if(nImageFileCount===0){readyModeBG();goReadyMode()}if(!bAttachEvent){addEvent()}}function addEvent(){bAttachEvent=true;elDropArea.addEventListener("dragenter",dragEnter,false);elDropArea.addEventListener("dragexit",dragExit,false);elDropArea.addEventListener("dragover",dragOver,false);elDropArea.addEventListener("drop",drop,false)}function removeEvent(){bAttachEvent=false;elDropArea.removeEventListener("dragenter",dragEnter,false);elDropArea.removeEventListener("dragexit",dragExit,false);elDropArea.removeEventListener("dragover",dragOver,false);elDropArea.removeEventListener("drop",drop,false)}function onAjaxError(){alert("[가이드]사진 업로더할 서버URL셋팅이 필요합니다.-onAjaxError")}function uploadImage(a){if(!bSupportDragAndDropAPI){generalUpload()}else{html5Upload()}}function callFileUploader(){oFileUploader=new jindo.FileUploader(jindo.$("uploadInputBox"),{sUrl:"/share/editor_file_uploader_ps.php?editorUrl="+editorUrl,sCallback:location.href.replace(/\/[^\/]*$/,"")+"/callback.html",sFiletype:"*.jpg;*.png;*.bmp;*.gif",sMsgNotAllowedExt:"JPG, GIF, PNG, BMP 확장자만 가능합니다",bAutoUpload:false,bAutoReset:true}).attach({select:function(a){if(a.bAllowed===true){goStartMode()}else{goReadyMode();oFileUploader.reset()}},success:function(a){var b=[];b[0]=a.htResult;setPhotoToEditor(b);goReadyMode();oFileUploader.reset();window.close()},error:function(a){alert(a.htResult.errstr)}})}function closeWindow(){if(bSupportDragAndDropAPI){removeEvent()}window.close()}window.onload=function(){checkDragAndDropAPI();if(bSupportDragAndDropAPI){$Element("pop_container2").hide();$Element("pop_container").show();welTextGuide.removeClass("nobg");welTextGuide.className("bg");addEvent()}else{$Element("pop_container").hide();$Element("pop_container2").show();callFileUploader()}fnUploadImage=$Fn(uploadImage,this);$Fn(closeWindow,this).attach(welBtnCancel.$value(),"click")};function setPhotoToEditor(a){opener.nhn.husky.PopUpManager.setCallback(window,"SET_PHOTO",[a])}jindo.$Ajax.prototype.request=function(c){this._status++;var m=this;var g=this._request;var d=this._options;var f,l,j=[],f="";var e=null;var b=this._url;this._is_abort=false;if(d.postBody&&d.type.toUpperCase()=="XHR"&&d.method.toUpperCase()!="GET"){if(typeof c=="string"){f=c}else{f=jindo.$Json(c).toString()}}else{if(typeof c=="undefined"||!c){f=null}else{f=c}}g.open(d.method.toUpperCase(),b,d.async);if(d.sendheader){if(!this._headers["Content-Type"]){g.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8")}g.setRequestHeader("charset","utf-8");for(var i in this._headers){if(this._headers.hasOwnProperty(i)){if(typeof this._headers[i]=="function"){continue}g.setRequestHeader(i,String(this._headers[i]))}}}var h=navigator.userAgent;if(g.addEventListener&&!(h.indexOf("Opera")>-1)&&!(h.indexOf("MSIE")>-1)){if(this._loadFunc){g.removeEventListener("load",this._loadFunc,false)}this._loadFunc=function(a){clearTimeout(e);e=undefined;m._onload(a)};g.addEventListener("load",this._loadFunc,false)}else{if(typeof g.onload!="undefined"){g.onload=function(a){if(g.readyState==4&&!m._is_abort){clearTimeout(e);e=undefined;m._onload(a)}}}else{if(window.navigator.userAgent.match(/(?:MSIE) ([0-9.]+)/)[1]==6&&d.async){var k=function(a){if(g.readyState==4&&!m._is_abort){if(e){clearTimeout(e);e=undefined}m._onload(a);clearInterval(m._interval);m._interval=undefined}};this._interval=setInterval(k,300)}else{g.onreadystatechange=function(a){if(g.readyState==4){clearTimeout(e);e=undefined;m._onload(a)}}}}}g.send(f);return this};
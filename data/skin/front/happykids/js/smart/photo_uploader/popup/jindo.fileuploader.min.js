jindo.Component=jindo.$Class({_htEventHandler:null,_htOption:null,$init:function(){var a=this.constructor.getInstance();a.push(this);this._htEventHandler={};this._htOption={};this._htOption._htSetter={}},option:function(c,b){switch(typeof c){case"undefined":return this._htOption;case"string":if(typeof b!="undefined"){if(c=="htCustomEventHandler"){if(typeof this._htOption[c]=="undefined"){this.attach(b)}else{return this}}this._htOption[c]=b;if(typeof this._htOption._htSetter[c]=="function"){this._htOption._htSetter[c](b)}}else{return this._htOption[c]}break;case"object":for(var a in c){if(a=="htCustomEventHandler"){if(typeof this._htOption[a]=="undefined"){this.attach(c[a])}else{continue}}this._htOption[a]=c[a];if(typeof this._htOption._htSetter[a]=="function"){this._htOption._htSetter[a](c[a])}}break}return this},optionSetter:function(c,a){switch(typeof c){case"undefined":return this._htOption._htSetter;case"string":if(typeof a!="undefined"){this._htOption._htSetter[c]=jindo.$Fn(a,this).bind()}else{return this._htOption._htSetter[c]}break;case"object":for(var b in c){this._htOption._htSetter[b]=jindo.$Fn(c[b],this).bind()}break}return this},fireEvent:function(b,k){k=k||{};var d=this["on"+b],c=this._htEventHandler[b]||[],h=typeof d=="function",g=c.length>0;if(!h&&!g){return true}c=c.concat();k.sType=b;if(typeof k._aExtend=="undefined"){k._aExtend=[];k.stop=function(){if(k._aExtend.length>0){k._aExtend[k._aExtend.length-1].bCanceled=true}}}k._aExtend.push({sType:b,bCanceled:false});var f=[k],e,j;for(e=2,j=arguments.length;e<j;e++){f.push(arguments[e])}if(h){d.apply(this,f)}if(g){var a;for(e=0,a;(a=c[e]);e++){a.apply(this,f)}}return !k._aExtend.pop().bCanceled},attach:function(c,a){if(arguments.length==1){jindo.$H(arguments[0]).forEach(jindo.$Fn(function(d,e){this.attach(e,d)},this).bind());return this}var b=this._htEventHandler[c];if(typeof b=="undefined"){b=this._htEventHandler[c]=[]}b.push(a);return this},detach:function(e,b){if(arguments.length==1){jindo.$H(arguments[0]).forEach(jindo.$Fn(function(f,g){this.detach(g,f)},this).bind());return this}var d=this._htEventHandler[e];if(d){for(var a=0,c;(c=d[a]);a++){if(c===b){d=d.splice(a,1);break}}}return this},detachAll:function(c){var b=this._htEventHandler;if(arguments.length){if(typeof b[c]=="undefined"){return this}delete b[c];return this}for(var a in b){delete b[a]}return this}});jindo.Component.factory=function(b,f){var c=[],a;if(typeof f=="undefined"){f={}}for(var d=0,e;(e=b[d]);d++){a=new this(e,f);c[c.length]=a}return c};jindo.Component.getInstance=function(){if(typeof this._aInstance=="undefined"){this._aInstance=[]}return this._aInstance};jindo.UIComponent=jindo.$Class({$init:function(){this._bIsActivating=false},isActivating:function(){return this._bIsActivating},activate:function(){if(this.isActivating()){return this}this._bIsActivating=true;if(arguments.length>0){this._onActivate.apply(this,arguments)}else{this._onActivate()}return this},deactivate:function(){if(!this.isActivating()){return this}this._bIsActivating=false;if(arguments.length>0){this._onDeactivate.apply(this,arguments)}else{this._onDeactivate()}return this}}).extend(jindo.Component);jindo.FileUploader=jindo.$Class({_bIsActivating:false,_aHiddenInput:[],$init:function(a,b){var c={sUrl:"",sCallback:"",htData:{},sFiletype:"*",sMsgNotAllowedExt:"업로드가 허용되지 않는 파일형식입니다",bAutoUpload:false,bAutoReset:true,bActivateOnload:true};this.option(c);this.option(b||{});this._el=jindo.$(a);this._wel=jindo.$Element(this._el);this._elForm=this._el.form;this._aHiddenInput=[];this.constructor._oCallback={};this._wfChange=jindo.$Fn(this._onFileSelectChange,this);if(this.option("bActivateOnload")){this.activate()}},_appendIframe:function(){var a="tmpFrame_"+this._makeUniqueId();this._welIframe=jindo.$Element(jindo.$('<iframe name="'+a+'" src="'+this.option("sCallback")+'?blank">')).css({width:"10px",border:"2px",height:"10px",left:"10px",top:"10px"});document.body.appendChild(this._welIframe.$value())},_removeIframe:function(){this._welIframe.leave()},getBaseElement:function(){return this.getFileSelect()},getFileSelect:function(){return this._el},getFormElement:function(){return this._elForm},upload:function(){this._appendIframe();var d=this.getFormElement(),g=jindo.$Element(d),e=this._welIframe.attr("name"),b=e+"_func",a=this.option("sUrl");g.attr({target:e,action:a});this._aHiddenInput.push(this._createElement("input",{type:"hidden",name:"callback",value:this.option("sCallback")}));this._aHiddenInput.push(this._createElement("input",{type:"hidden",name:"callback_func",value:b}));for(var c in this.option("htData")){this._aHiddenInput.push(this._createElement("input",{type:"hidden",name:c,value:this.option("htData")[c]}))}for(var f=0;f<this._aHiddenInput.length;f++){d.appendChild(this._aHiddenInput[f])}this.constructor._oCallback[b+"_success"]=jindo.$Fn(function(h){this.fireEvent("success",{htResult:h});delete this.constructor._oCallback[h.callback_func+"_success"];delete this.constructor._oCallback[h.callback_func+"_error"];for(var j=0;j<this._aHiddenInput.length;j++){jindo.$Element(this._aHiddenInput[j]).leave()}this._aHiddenInput.length=0;this._removeIframe()},this).bind();this.constructor._oCallback[b+"_error"]=jindo.$Fn(function(h){this.fireEvent("error",{htResult:h});delete this.constructor._oCallback[h.callback_func+"_success"];delete this.constructor._oCallback[h.callback_func+"_error"];for(var j=0;j<this._aHiddenInput.length;j++){jindo.$Element(this._aHiddenInput[j]).leave()}this._aHiddenInput.length=0;this._removeIframe()},this).bind();d.submit();if(this.option("bAutoReset")){this.reset()}},reset:function(){var c=jindo.$("<form>");this._wel.wrap(c);c.reset();jindo.$Element(c).replace(this._el);var a=this.getFormElement(),b=jindo.$Element(a);b.attr({target:this._sPrevTarget,action:this._sAction});return this},_onActivate:function(){var a=this.getFormElement(),b=jindo.$Element(a);this._sPrevTarget=b.attr("target");this._sAction=b.attr("action");this._el.value="";this._wfChange.attach(this._el,"change")},_onDeactivate:function(){this._wfChange.detach(this._el,"change")},_makeUniqueId:function(){return new Date().getMilliseconds()+Math.floor(Math.random()*100000)},_createElement:function(d,c){var e=jindo.$("<"+d+">");var b=jindo.$Element(e);for(var a in c){b.attr(a,c[a])}return e},_checkExtension:function(c){var a=this.option("sFiletype").split(";");for(var b=0,d;b<a.length;b++){d=(a[b]=="*.*")?"*":a[b];d=d.replace(/^\s+|\s+$/,"");d=d.replace(/\./g,"\\.");d=d.replace(/\*/g,"[^\\/]+");if((new RegExp(d+"$","gi")).test(c)){return true}}return false},_onFileSelectChange:function(b){var d=b.element.value,a=this._checkExtension(d),c={sValue:d,bAllowed:a,sMsgNotAllowedExt:this.option("sMsgNotAllowedExt")};if(d.length&&this.fireEvent("select",c)){if(a){if(this.option("bAutoUpload")){this.upload()}}else{alert(c.sMsgNotAllowedExt)}}}}).extend(jindo.UIComponent);